{% extends "base.html" %}

{% block title %}{{ t(g, "–û–Ω–ª–∞–π–Ω-–∑–±–æ—Ä–∏", "Online-Versammlungen") }} - BRAMA-UAe.V2025{% endblock %}

{% block content %}
<div class="fade-in">
    <h1>üìÖ {{ t(g, "–û–Ω–ª–∞–π–Ω-–∑–±–æ—Ä–∏ BRAMA-UAe", "BRAMA-UAe Online-Versammlungen") }}</h1>
    
    <div class="content-block">
        <p class="lead">
            {{ t(g, 
               "–î–µ–º–æ–∫—Ä–∞—Ç–∏—á–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏ –≤ –¥—ñ—ó - –≤—Å—ñ —É—á–∞—Å–Ω–∏–∫–∏ –º–æ–∂—É—Ç—å –±—Ä–∞—Ç–∏ —É—á–∞—Å—Ç—å —É –∑–±–æ—Ä–∞—Ö –æ–Ω–ª–∞–π–Ω –∑ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è–º–∏ —Ç–∞ –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è–º–∏.",
               "Demokratische Prozesse in Aktion - alle Mitglieder k√∂nnen online an Versammlungen mit Abstimmungen und Diskussionen teilnehmen."
            ) }}
        </p>
    </div>

    <!-- Meetings List -->
    {% if meetings %}
        {% for meeting in meetings %}
        <div class="content-block">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2>{{ meeting.title }}</h2>
                <span class="project-status review">
                    {{ meeting.starts_at.strftime('%d.%m.%Y %H:%M') }}
                </span>
            </div>
            
            <p>{{ meeting.description }}</p>
            
            <!-- Meeting Agenda -->
            {% if meeting.agenda_items %}
            <div style="margin: 2rem 0;">
                <h3>{{ t(g, "–ü–æ—Ä—è–¥–æ–∫ –¥–µ–Ω–Ω–∏–π", "Tagesordnung") }}</h3>
                {% for item in meeting.agenda_items %}
                <div class="project-card">
                    <h4>{{ loop.index }}. {{ item.title }}</h4>
                    <p>{{ item.details }}</p>
                    
                    <!-- Voting for agenda item -->
                    <div style="margin-top: 1rem;">
                        <p><strong>{{ t(g, "–ì–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è", "Abstimmung") }}:</strong></p>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="voteAgendaItem({{ meeting.id }}, {{ item.id }}, 1)" class="btn btn-success btn-sm">
                                üëç {{ t(g, "–ó–∞", "Daf√ºr") }}
                            </button>
                            <button onclick="voteAgendaItem({{ meeting.id }}, {{ item.id }}, 0)" class="btn btn-warning btn-sm">
                                ü§∑ {{ t(g, "–£—Ç—Ä–∏–º.", "Enthalt.") }}
                            </button>
                            <button onclick="voteAgendaItem({{ meeting.id }}, {{ item.id }}, -1)" class="btn btn-danger btn-sm">
                                üëé {{ t(g, "–ü—Ä–æ—Ç–∏", "Dagegen") }}
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Meeting Discussion (placeholder) -->
            <div style="margin: 2rem 0; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                <h3>{{ t(g, "–û–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è", "Diskussion") }}</h3>
                <p>{{ t(g, "–§—É–Ω–∫—Ü—ñ—è –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è –±—É–¥–µ –¥–æ–¥–∞–Ω–∞ –≤ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π —ñ—Ç–µ—Ä–∞—Ü—ñ—ó.", "Die Diskussionsfunktion wird in der n√§chsten Iteration hinzugef√ºgt.") }}</p>
                <small>{{ t(g, "–ü–æ–∫–∏ —â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —á–∞—Ç-–ø–æ–º—ñ—á–Ω–∏–∫ –¥–ª—è –ø–∏—Ç–∞–Ω—å.", "Derzeit k√∂nnen Sie den Chat-Assistenten f√ºr Fragen nutzen.") }}</small>
            </div>
            
            {% if current_user.is_authenticated and current_user.roles %}
                {% for role in current_user.roles %}
                    {% if role.name == 'admin' %}
                    <div style="margin-top: 2rem; padding: 1rem; background: #fff3cd; border-radius: 8px; border-left: 4px solid var(--warning-color);">
                        <h4>{{ t(g, "–ê–¥–º—ñ–Ω-–¥—ñ—ó", "Admin-Aktionen") }}</h4>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <button onclick="addAgendaItem({{ meeting.id }})" class="btn btn-primary btn-sm">
                                ‚ûï {{ t(g, "–î–æ–¥–∞—Ç–∏ –ø—É–Ω–∫—Ç –ø–æ—Ä—è–¥–∫—É", "Tagesordnungspunkt hinzuf√ºgen") }}
                            </button>
                            <button onclick="showMeetingStats({{ meeting.id }})" class="btn btn-info btn-sm" style="background-color: var(--info-color); color: white;">
                                üìä {{ t(g, "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥–æ–ª–æ—Å—É–≤–∞–Ω—å", "Abstimmungsstatistiken") }}
                            </button>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            {% endif %}
        </div>
        {% endfor %}
    {% else %}
        <div class="content-block" style="text-align: center;">
            <h2>{{ t(g, "–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –∑–∞–ø–ª–∞–Ω–æ–≤anih –∑–±–æ—Ä—ñ–≤", "Noch keine geplanten Versammlungen") }}</h2>
            <p>{{ t(g, "–ó–±–æ—Ä–∏ –±—É–¥—É—Ç—å –∑'—è–≤–ª—è—Ç–∏—Å—è —Ç—É—Ç, –∫–æ–ª–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—è —ó—Ö —Å—Ç–≤–æ—Ä–∏—Ç—å.", "Versammlungen werden hier angezeigt, wenn die Administration sie erstellt.") }}</p>
            
            {% if current_user.is_authenticated and current_user.roles %}
                {% for role in current_user.roles %}
                    {% if role.name == 'admin' %}
                    <a href="{{ url_for('admin.home') }}" class="btn btn-primary">
                        {{ t(g, "–°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–±–æ—Ä–∏", "Versammlung erstellen") }}
                    </a>
                    {% endif %}
                {% endfor %}
            {% endif %}
        </div>
    {% endif %}

    <!-- Information Block -->
    <div class="content-block" style="background: linear-gradient(135deg, #e3f2fd, #f3e5f5); border: none;">
        <h2>{{ t(g, "–Ø–∫ –ø—Ä–∞—Ü—é—é—Ç—å –æ–Ω–ª–∞–π–Ω-–∑–±–æ—Ä–∏", "Wie Online-Versammlungen funktionieren") }}</h2>
        <div class="dashboard-grid">
            <div>
                <h3>üîí {{ t(g, "–ë–µ–∑–ø–µ–∫–∞", "Sicherheit") }}</h3>
                <p>{{ t(g, "–¢—ñ–ª—å–∫–∏ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ —É—á–∞—Å–Ω–∏–∫–∏ –º–æ–∂—É—Ç—å –≥–æ–ª–æ—Å—É–≤–∞—Ç–∏", "Nur registrierte Mitglieder k√∂nnen abstimmen") }}</p>
            </div>
            <div>
                <h3>üìä {{ t(g, "–ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å", "Transparenz") }}</h3>
                <p>{{ t(g, "–í—Å—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≥–æ–ª–æ—Å—É–≤–∞–Ω—å –≤—ñ–¥–∫—Ä–∏—Ç—ñ", "Alle Abstimmungsergebnisse sind offen") }}</p>
            </div>
            <div>
                <h3>‚è∞ {{ t(g, "–ì–Ω—É—á–∫—ñ—Å—Ç—å", "Flexibilit√§t") }}</h3>
                <p>{{ t(g, "–£—á–∞—Å—Ç—å –º–æ–∂–ª–∏–≤–∞ –∑ –±—É–¥—å-—è–∫–æ–≥–æ –º—ñ—Å—Ü—è", "Teilnahme von √ºberall m√∂glich") }}</p>
            </div>
        </div>
    </div>
</div>

<style>
.btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
}
</style>

<script>
async function voteAgendaItem(meetingId, agendaItemId, value) {
    try {
        // This would be implemented in a future iteration
        BRAMAUtils.showNotification(
            '{{ t(g, "–§—É–Ω–∫—Ü—ñ—è –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è –±—É–¥–µ –¥–æ–¥–∞–Ω–∞ –≤ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π –≤–µ—Ä—Å—ñ—ó", "Abstimmungsfunktion wird in der n√§chsten Version hinzugef√ºgt") }}', 
            'info'
        );
    } catch (error) {
        BRAMAUtils.showNotification(
            '{{ t(g, "–ü–æ–º–∏–ª–∫–∞ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è", "Abstimmungsfehler") }}', 
            'danger'
        );
    }
}

function addAgendaItem(meetingId) {
    const title = prompt('{{ t(g, "–ù–∞–∑–≤–∞ –ø—É–Ω–∫—Ç—É –ø–æ—Ä—è–¥–∫—É –¥–µ–Ω–Ω–æ–≥–æ:", "Titel des Tagesordnungspunkts:") }}');
    const details = prompt('{{ t(g, "–î–µ—Ç–∞–ª—ñ (–Ω–µ–æ–±–æ–≤\\'—è–∑–∫–æ–≤–æ):", "Details (optional):") }}');
    
    if (title) {
        BRAMAUtils.showNotification(
            '{{ t(g, "–§—É–Ω–∫—Ü—ñ—è –±—É–¥–µ –¥–æ–¥–∞–Ω–∞ –≤ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π —ñ—Ç–µ—Ä–∞—Ü—ñ—ó", "Funktion wird in der n√§chsten Iteration hinzugef√ºgt") }}', 
            'info'
        );
    }
}

function showMeetingStats(meetingId) {
    BRAMAUtils.showNotification(
        '{{ t(g, "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥–æ–ª–æ—Å—É–≤–∞–Ω—å –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π –≤–µ—Ä—Å—ñ—ó", "Abstimmungsstatistiken werden in der n√§chsten Version verf√ºgbar sein") }}', 
        'info'
    );
}
</script>
{% endblock %}